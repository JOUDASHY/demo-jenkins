pipeline {
    agent any
    stages {
        stage('Clone and clean repo') {
            steps {
                deleteDir()
                sh 'git clone git@github.com:JOUDASHY/demo-jenkins.git'
                dir('demo-jenkins') {
                    sh 'mvn clean'
                }
            }
        }
        stage('Test') {
            steps {
                dir('demo-jenkins') {
                    sh 'mvn test'
                }
            }
        }
        stage('Build & Install') {
            steps {
                dir('demo-jenkins') {
                    sh 'mvn package install'
                }
            }
        }
        stage('SonarQube Analysis') {
            steps {
                dir('demo-jenkins') {
                    sh """
                        mvn sonar:sonar \
                          -Dsonar.projectKey=demo-jenkins \
                          -Dsonar.host.url=http://localhost:9000 \
                          -Dsonar.login=sqa_1b37d75b066855d65bce0edf5b12a261d04e8689
                    """
                }
            }
        }
    }
}
